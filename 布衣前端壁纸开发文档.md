# å£çº¸é¡¹ç›®

åšä¸€ä¸ªå¥½çœ‹è€Œåˆéšå¿ƒåˆ‡æ¢æ¡Œé¢å£çº¸å·¥å…·ï¼Œå¸‚é¢ä¸Šçš„å£çº¸å¤§å¤šå¤ªè‡ƒè‚¿ï¼Œä¸å¤Ÿä¸ªæ€§åŒ–ï¼Œè€Œä¸”å¥½å¤šåŠŸèƒ½éœ€è¦æ”¶è´¹ï¼Œè¿™æ˜¯å»ºç«‹åˆè¡·ã€‚

## èµ„æºåˆ—è¡¨

é¢„å¤‡èµ„æºåº“

1. å›¾ç‰‡åº“ï¼šhttps://pixabay.com/ã€[
   Photos](https://pixabay.com/zh/photos/)

   [Illustrations](https://pixabay.com/zh/illustrations/)

   [Vectors](https://pixabay.com/zh/vectors/)

   [Videos](https://pixabay.com/zh/videos/)

   [Music](https://pixabay.com/zh/music/)

   [Sound Effects](https://pixabay.com/zh/sound-effects/)

   [GIFs](https://pixabay.com/zh/gifs/)ã€‘

2. å›¾ç‰‡åº“ï¼šhttps://www.pexels.com/zh-cn/popular-searches/



## æŠ€æœ¯æ ˆ



| åç§°                                                         | ç‰ˆæœ¬      | å¤‡æ³¨                                                         |
| ------------------------------------------------------------ | --------- | ------------------------------------------------------------ |
| electron-builder                                             | 23.6.0    | Electron Builder æ˜¯ä¸€ä¸ªå®Œå¤‡çš„Electronåº”ç”¨æ‰“åŒ…å’Œåˆ†å‘è§£å†³æ–¹æ¡ˆï¼Œå®ƒè‡´åŠ›äºè½¯ä»¶å¼€å‘çš„é›†æˆä½“éªŒã€‚ [`electron-builder`](https://github.com/electron-userland/electron-builder) å‡ºäºç®€åŒ–çš„ç›®çš„æ·»åŠ äº†ä¸€ä¸ªä¾èµ–é¡¹ï¼Œå¯ä»¥åœ¨å†…éƒ¨ç®¡ç†æ‰€æœ‰æ›´å¤šçš„è¦æ±‚ã€‚ã€æ»¡è¶³åº”ç”¨åœ¨çº¿è‡ªåŠ¨æ›´æ–°æˆ–æ‰‹åŠ¨æ›´æ–°ã€‘ |
| electron                                                     | 24.1.1    | ä¸»æ¡†æ¶                                                       |
| electron-reloader                                            | 1.2.3     | çƒ­åŠ è½½æ’ä»¶                                                   |
| [electron-as-wallpaper](https://github.com/meslzy/electron-as-wallpaper)ğŸš | 0.0.2-dev | æ ¸å¿ƒæ’ä»¶ã€æ”¯æŒå›¾ç‰‡å£çº¸ï¼Œè§†é¢‘å£çº¸ï¼ŒåŠ¨æ€å£çº¸ï¼Œç½‘é¡µå£çº¸ã€‘ï¼Œå°†çª—å£è‡³äºwindowå›¾æ ‡ä¹‹ä¸‹ï¼ŒèƒŒæ™¯å›¾ç‰‡ä¹‹ä¸Šçš„æ’ä»¶ã€‚ |
| nodejs                                                       | 18.14.0   |                                                              |

> npm æ¨èä½¿ç”¨æ·˜å®é•œåƒï¼Œä¸‹è½½ä½“éªŒæ›´ä½³

## asarè§£å‹æ­¥éª¤

```bash
npm install -g asar
/**
	cdåˆ°app.asaræ‰€åœ¨çš„ç›®å½•,å°†æ–‡ä»¶è§£å‹åˆ°fileæ–‡ä»¶å¤¹
**/
asar extract ./app.asar ./file
```

å–æ¶ˆgitå®‰å…¨è®¤è¯æäº¤çš„æ–¹æ³•ï¼šå‘½ä»¤è¡Œ=ã€‹

```bash
git config --global http.sslVerify "false"
```

## æ‰“åŒ…é…ç½®

electronæ‰“åŒ…é…ç½®æ’ä»¶ä¹Ÿæœ‰å¾ˆå¤šï¼Œè¿™é‡Œç”¨electron-builderï¼Œå…¶æ‹¥æœ‰å®Œæ•´å‡ºè‰²çš„æ–‡æ¡£å¯ä»¥å‚é˜…ï¼ŒåŒæ—¶å®ƒè‡ªå¸¦è‡ªåŠ¨æ›´æ–°appåŠŸèƒ½æ¨¡å—ï¼Œåªéœ€è¦é…ç½®å°‘è®¸ä»£ç ï¼Œå°±èƒ½å°†electroné¡¹ç›®å¾ˆå¥½åœ°æ‰“åŒ…ç”Ÿäº§æ ‡å‡†exeæ–‡ä»¶ï¼Œæ‰“åŒ…åçš„æ–‡ä»¶å°±å¯ä»¥å®‰è£…å’Œåˆ†äº«ç»™æœ‰éœ€è¦çš„ä¼™ä¼´äº†ã€‚

å€¼å¾—ä¸€æçš„æ˜¯ï¼šelectron-reloader æ‰“åŒ…æ˜¯ä»¥nsisæ¨¡å¼è¿›è¡Œçš„ã€‚

å®‰è£…å‘½ä»¤

```bash
npm i electron-builder
```

package.jsoné…ç½®ï¼Œé…ç½®å±æ€§ä¸åšè¿‡å¤šè§£é‡Šï¼Œè‡ªè¡Œå‚é˜…æ–‡æ¡£ã€‚åœ°å€ï¼šhttps://www.electron.build/

```json
"build": {
		"appId": "com.wallpaper.app",
		"productName": "CommonerWallpaper",
		"copyright": "Copyright Â© 2023 Qiu",
		"mac": {
			"category": "public.app-category.utilities"
		},
		"win": {
			"target": [
				{
					"target": "nsis",
					"arch": [
						"x64"
					]
				}
			],
			"icon": "./public/logo.ico",
			"publish": [
				{
					"provider": "generic",
					"url": "http://39.106.29.92:8789/"
				}
			]
		},
		"nsis": {
			"oneClick": false,
			"perMachine": true,
			"allowElevation": true,
			"allowToChangeInstallationDirectory": true,
			"installerIcon": "./public/logo.ico",
			"uninstallerIcon": "./public/icon.ico",
			"installerHeaderIcon": "./public/icon.ico",
			"createDesktopShortcut": true,
			"createStartMenuShortcut": true,
			"displayLanguageSelector": true,
			"shortcutName": "commoner"
		},
		"directories": {
			"output": "dist_electron"
		},
		"files": [
			"dist/electron/**/*",
			"./src/**/*",
			"./public/**/*"
		],
		"extends": null,
		"extraResources": {
			"from": "./extraResources/",
			"to": "extraResources"
		}
	}
```





## çƒ­åŠ è½½é…ç½®

electronçš„çƒ­åŠ è½½æ’ä»¶å¾ˆå¤šï¼Œçƒ­åŠ è½½èƒ½å‡å°‘é‡å¤å¯åŠ¨é¡¹ç›®çš„å·¥ä½œï¼Œè¿™é‡Œä½¿ç”¨electron-reloaderï¼Œå°±èƒ½å®Œç¾è§£å†³è¿™ä¸€éš¾é¢˜ã€‚

å®‰è£…å‘½ä»¤

```bash
npm i electron-reloader
```

åœ¨ä¸»è¿›ç¨‹ä¸­main.jsé…ç½®

```js
// hot reloader config
try {
    require('electron-reloader')(module);
} catch (_) { }
```

é‡å¯é¡¹ç›®å°±èƒ½çœ‹åˆ°çƒ­åŠ è½½æ•ˆæœï¼Œä¸ç”¨é‡å¤çš„å¯åŠ¨é¡¹ç›®å‘½ä»¤äº†ã€‚



## è¿œç¨‹æ¨¡å—é…ç½®

electronè¿œç¨‹æ¨¡å—èƒ½å¤Ÿæœ‰æ•ˆå¸®åŠ©å¼€å‘è€…è°ƒç”¨ä¸»è¿›ç¨‹APIï¼Œçµæ´»è°ƒç”¨çª—å£ç±»å‹ï¼Œé™ä½ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„å¤æ‚åº¦ã€‚

å®‰è£…å‘½ä»¤

```bash
npm i @electron/remote
```

åœ¨ä¸»è¿›ç¨‹main.jsæ–‡ä»¶å†…é…ç½®ï¼Œé‡å¯é¡¹ç›®åç”Ÿæ•ˆã€‚

```js
// remote module
require('@electron/remote/main').initialize()
require('@electron/remote/main').enable(mainWindow.webContents)
```

ä¸»çª—å£ç±»é…ç½®enableRemoteModuleï¼Œå¼€å¯è¿œç¨‹æ¨¡å—ï¼Œå¦åˆ™å®‰è£…åæ— æ³•ç”Ÿæ•ˆã€‚

```js
const { app, BrowserWindow } = require('electron');
const path = require('path')

class BaseInfo {
    constructor() {
        this.icon = path.resolve( __dirname,'../../public/logo.ico')
        this.webPreferences = {
            enableRemoteModule: true,
            webSecurity: false, 
            nodeIntegration: true,
            contextIsolation: false,
            webviewTag: true,
            preload: path.join(__dirname, 'preload.js')
        }
    }
}

class createWindow extends BaseInfo {
    constructor(width, height) {
        // ç»™çˆ¶ç±»ä¼ é€’å‚æ•°
        super()
        this.width = width
        this.height = height
    }
}

exports.createWindow = function (width = 800, height = 600) {
    return new BrowserWindow({ ...new createWindow(width, height)})
}
```

å°æ¡ˆä¾‹ï¼šæ¸²æŸ“è¿›ç¨‹è°ƒå–ç³»ç»Ÿé€‰æ‹©æ–‡ä»¶å¤¹åŠŸèƒ½



```js
const { dialog } = require("@electron/remote");

dialog.showSaveDialog({
    title: 'æ–‡ä»¶ä¿å­˜åˆ°',
    buttonLabel:'ç¡®å®š',
    properties:['showHiddenFiles']
}).then(res =>{
    if (res.filePath) {
        // è¿™é‡Œè·å¾—ç”¨æˆ·é€‰æ‹©çš„ä¿å­˜è·¯å¾„ï¼Œ'å¸ƒè¡£å‰ç«¯'ï¼šxxx.txtçš„å†…å®¹
        fs.writeFileSync(res.filePath, 'å¸ƒè¡£å‰ç«¯')
    }
    console.log(res)
}).catch(err =>{
    this.$Message.error(err)
})
```

## çŠ¶æ€æ æ‰˜ç›˜Trayé…ç½®

electronå…è®¸å¼€å‘è€…æŠŠä¸»è¿›ç¨‹ä¸šåŠ¡æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ï¼Œå¯¼å…¥ä¸»è¿›ç¨‹main.jsä¸­ä½¿ç”¨ã€‚æ‰˜ç›˜é…ç½®éœ€è¦åœ¨åˆ›å»ºçª—å£æ—¶è¿›è¡Œé…ç½®ã€‚

tray.jsæ–‡ä»¶å†…å®¹

```js
const { Tray, Menu, app } = require('electron')
const path = require("path")
let customWindows;
exports.customTray = function (mainWindow) {
    customWindows = mainWindow;
    const tray = new Tray(path.resolve(__dirname, '../../public/logo.ico'))
    const contextMenu = Menu.buildFromTemplate([
        { 
            label: 'æ‰“å¼€åº”ç”¨', 
            type: 'checkbox', 
            click: ()=>{
                customWindows.setSkipTaskbar(true)
                customWindows.show()
            }
        },
        // { 
        //     label: 'ä¸ªäººä¸­å¿ƒ', 
        //     type: 'checkbox',
        //     click: ()=>{
        //         mainWindow.webContents.send('href','/personal-main')
        //     }
        // },
        // { label: 'è®¾ç½®', type: 'checkbox' },
        { 
            label: 'é€€å‡º', 
            type: 'checkbox',
            click: () => {
                // ä¸»çª—å£è®¾ç½®ä¸ºnullé˜²æ­¢å†…å­˜æº¢å‡º
                customWindows = null 
                app.exit()
            }        
        }
    ])
    tray.setToolTip('å¸ƒè¡£å‰ç«¯å£çº¸.')
    tray.setContextMenu(contextMenu)
    // æ‰˜ç›˜å›¾æ ‡è¢«åŒå‡»äº‹ä»¶
    tray.on('double-click', () => {
        customWindows.setSkipTaskbar(true)
        customWindows.show()
    })
}
```

ä¸»è¿›ç¨‹åº”ç”¨tray.jsæ–‡ä»¶

```js
require('./tray.js').customTray(mainWindow)
```

## çª—å£é»˜è®¤å…³é—­è¡Œä¸ºé˜»æ­¢

åœ¨åˆ›å»ºä¸»è¿›ç¨‹çª—å£è¿‡ç¨‹å‡½æ•°ä¸­ç›‘å¬ï¼Œå¥½å¤„æ˜¯ï¼šå¯ä»¥è‡ªå®šä¹‰çª—å£éšè—å’Œæ˜¾ç¤ºï¼Œå½“ç”¨æˆ·å…³é—­ä¸»çª—å£åéšè—é¡¹ç›®æ‰˜ç›˜åˆ°çŠ¶æ€æ ï¼Œæ–¹ä¾¿äºŒæ¬¡å¯åŠ¨æ—¶æ“ä½œã€‚

```js
mainWindow.on('close', function (event) {
        // é˜»æ­¢é»˜è®¤çª—å£å…³é—­äº‹ä»¶
        event.preventDefault()
        // å¼ºåˆ¶é€€å‡ºæ•´ä¸ªç³»ç»Ÿ
        // app.exit()
        // å…³é—­å½“å‰çª—å£
        // app.quit()
        mainWindow.setSkipTaskbar(false)
        mainWindow.hide()
    })
```

## ç³»ç»Ÿç¯å¢ƒåˆ¤æ–­

electronæœ€æ–°ç‰ˆæœ¬24ä¸­ï¼Œæ— æ³•ä½¿ç”¨process.env.nodeæ¥è®¿é—®ç¯å¢ƒå˜é‡ï¼Œè€Œæ˜¯ç”¨appæ¨¡å—çš„app.isPackagedå±æ€§æ¥è·å–çš„ã€‚å½“electroné¡¹ç›®æ˜¯å¼€å‘ç¯å¢ƒæ˜¯app.isPackaged=falseï¼Œå¦åˆ™æ˜¯trueã€‚

ä¾‹å¦‚ä¸»è¿›ç¨‹ä¸­ç¯å¢ƒé…ç½®é€»è¾‘

```js
const IS_DEVELOPMENT = !app.isPackaged;
// development
    if (IS_DEVELOPMENT) {
        mainWindow.loadURL(path.resolve(
            __dirname,
            '../',
            'renderer',
            'index.html'
        ))
        // mainWindow.webContents.openDevTools()
        console.log('development', app.isPackaged);
    }
    // production
    else {
        console.log('production', app.isPackaged);
        mainWindow.loadFile(
            path.resolve(
                __dirname,
                '../',
                'renderer',
                'index.html'
            )
        )
    }
```

## å£çº¸æ’ä»¶

electron-as-wallpaperæ˜¯æœ¬é¡¹ç›®æ ¸å¿ƒï¼Œå…¶ç®€å•å¼ºå¤§ï¼Œä½œç”¨æ˜¯å°†å†™å¥½çš„é¡µé¢ç½®äºwindowå›¾æ ‡åº•å±‚æˆ–è€…é¡¶å±‚ï¼Œå½“ç„¶è¿˜æ”¯æŒè§†é¢‘ï¼Œå›¾ç‰‡ï¼ŒåŠ¨æ€gifç­‰ç­‰ã€‚

å®‰è£…å‘½ä»¤

```bash
npm install electron-as-wallpaper --save
```

ç”¨æ³•

```js
import {attach, detach, refresh} from "electron-as-wallpaper";
// or
const {attach, detach, refresh} = require("electron-as-wallpaper");
// å°†æ–‡ä»¶ç½®äºwindowå›¾æ ‡åº•å±‚
attach(mainWindow);
// å°†æ–‡ä»¶ç½®äºwindowå›¾æ ‡é¡¶å±‚
detach(mainWindow);

// å½“çª—å£å…³é—­æ—¶ï¼Œåº”è¯¥åˆ·æ–°æ¸…é™¤ä»¥ç”Ÿæˆçš„æ¡Œé¢å›¾æ ‡
refresh();
```

